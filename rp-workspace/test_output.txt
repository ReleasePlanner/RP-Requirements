
> nx run api:test

> jest --config jest.config.js

 FAIL  src/infrastructure/auth/guards/jwt-auth.guard.spec.ts (8.87 s)
  Ã”Ã¹Ã… JwtAuthGuard Ã”Ã‡â•‘ canActivate Ã”Ã‡â•‘ should allow access for public routes

    TypeError: context.switchToHttp is not a function

      13 |     // [MOCK-OVERRIDE] Per user request: "no manejar autorizacion por ahora es un mock"
      14 |     // We inject a mock user so controllers don't crash if they access req.user
    > 15 |     const request = context.switchToHttp().getRequest();
         |                             ^
      16 |     request.user = {
      17 |       userId: 'mock-sys-admin',
      18 |       name: 'System Admin (Mock)',

      at JwtAuthGuard.canActivate (infrastructure/auth/guards/jwt-auth.guard.ts:15:29)
      at Object.<anonymous> (infrastructure/auth/guards/jwt-auth.guard.spec.ts:27:28)

  Ã”Ã¹Ã… JwtAuthGuard Ã”Ã‡â•‘ canActivate Ã”Ã‡â•‘ should call parent canActivate for protected routes

    TypeError: context.switchToHttp is not a function

      13 |     // [MOCK-OVERRIDE] Per user request: "no manejar autorizacion por ahora es un mock"
      14 |     // We inject a mock user so controllers don't crash if they access req.user
    > 15 |     const request = context.switchToHttp().getRequest();
         |                             ^
      16 |     request.user = {
      17 |       userId: 'mock-sys-admin',
      18 |       name: 'System Admin (Mock)',

      at JwtAuthGuard.canActivate (infrastructure/auth/guards/jwt-auth.guard.ts:15:29)
      at Object.<anonymous> (infrastructure/auth/guards/jwt-auth.guard.spec.ts:49:13)

 PASS  src/infrastructure/auth/strategies/jwt.strategy.spec.ts (9.112 s)
 PASS  src/shared/interceptors/timeout.interceptor.spec.ts (9.341 s)
 FAIL  src/infrastructure/database/repositories/epics.repository.spec.ts (9.583 s)
  Ã”Ã¹Ã… EpicsRepository Ã”Ã‡â•‘ findById Ã”Ã‡â•‘ should return one epic

    TypeError: this.epicRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Epic | null> {
    > 21 |     return this.epicRepository.findOne({
         |                                ^
      22 |       where: { epicId: id },
      23 |       relations: ['status', 'initiative', 'requirements'],
      24 |     });

      at EpicsRepository.findById (infrastructure/database/repositories/epics.repository.ts:21:32)
      at Object.<anonymous> (infrastructure/database/repositories/epics.repository.spec.ts:50:31)

  Ã”Ã¹Ã… EpicsRepository Ã”Ã‡â•‘ update Ã”Ã‡â•‘ should update an epic

    TypeError: this.epicRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Epic | null> {
    > 21 |     return this.epicRepository.findOne({
         |                                ^
      22 |       where: { epicId: id },
      23 |       relations: ['status', 'initiative', 'requirements'],
      24 |     });

      at EpicsRepository.findById (infrastructure/database/repositories/epics.repository.ts:21:32)
      at EpicsRepository.update (infrastructure/database/repositories/epics.repository.ts:33:17)
      at Object.<anonymous> (infrastructure/database/repositories/epics.repository.spec.ts:67:14)

 PASS  src/presentation/health/health.controller.spec.ts (9.546 s)
 PASS  src/application/users/services/users.service.spec.ts
 PASS  src/application/auth/services/auth.service.spec.ts (9.759 s)
 PASS  src/app.controller.spec.ts
 PASS  src/application/catalogs/services/catalogs.service.spec.ts
 PASS  src/shared/config/config.validation.spec.ts
 PASS  src/shared/decorators/api-paginated-response.decorator.spec.ts (10.065 s)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 400 - Test error
HttpException: Test error
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:32:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 400 - Custom error
HttpException: Custom error
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:46:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 400 - Http Exception
HttpException: Http Exception
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:62:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 400 - Custom error
HttpException: Custom error
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:70:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 500 - Generic error
Error: Generic error
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:78:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 500 - Internal error
Error: Internal error
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:95:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 400 - Test error
HttpException: Test error
    at Object.<anonymous> (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\src\shared\filters\http-exception.filter.spec.ts:110:25)
    at Promise.then.completed (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:298:28)
    at new Promise (<anonymous>)
    at callAsyncCircusFn (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\utils.js:231:10)
    at _callCircusTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:316:40)
    at processTicksAndRejections (node:internal/process/task_queues:105:5)
    at _runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:252:3)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:126:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at _runTestsForDescribeBlock (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:121:9)
    at run (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\run.js:71:3)
    at runAndTransformResultsToJestFormat (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
    at jestAdapter (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
    at runTestInternal (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:367:16)
    at runTest (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\runTest.js:444:34)
    at Object.worker (C:\MySources\RP-Requirements-Web\rp-workspace\apps\api\node_modules\jest-runner\build\testWorker.js:106:12)
[Nest] 38612  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [HttpExceptionFilter] GET /test - 500 - Internal server error
 PASS  src/shared/filters/http-exception.filter.spec.ts
 PASS  src/infrastructure/database/database.config.spec.ts
 PASS  src/shared/interceptors/transform.interceptor.spec.ts
 PASS  src/shared/decorators/public.decorator.spec.ts
[Nest] 30792  - 19/12/2025, 3:58:29 p.â”¬Ã¡m.   ERROR [LoggingInterceptor] Request Failed: GET /test - Time: 1ms - Error: Test error
 PASS  src/shared/interceptors/logging.interceptor.spec.ts
 PASS  src/shared/exceptions/entity-not-found.exception.spec.ts
 PASS  src/shared/pipes/uuid-validation.pipe.spec.ts
 PASS  src/shared/dto/pagination.dto.spec.ts (10.395 s)
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mIncoming Request: GET /test - Body: {"password":"***REDACTED***","token":"***REDACTED***"} - Query: {"filter":"value"} - Params: {"id":"123"}[39m
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mOutgoing Response: GET /test - Status: 200 - Time: 4ms[39m
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mIncoming Request: GET /test - Body: {"password":"***REDACTED***","token":"***REDACTED***"} - Query: {"filter":"value"} - Params: {"id":"123"}[39m
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mOutgoing Response: GET /test - Status: 200 - Time: 1ms[39m
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mIncoming Request: GET /test - Body: {"password":"***REDACTED***","token":"***REDACTED***"} - Query: {"filter":"value"} - Params: {"id":"123"}[39m
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mIncoming Request: GET /test - Body: undefined - Query: {} - Params: {}[39m
[32m[Nest] 30792  - [39m19/12/2025, 3:58:29 p.â”¬Ã¡m. [32m    LOG[39m [38;5;3m[LoggingInterceptor] [39m[32mOutgoing Response: GET /test - Status: 200 - Time: 1ms[39m
 PASS  src/application/portfolios/services/portfolios.service.spec.ts
 PASS  src/infrastructure/repositories/user.repository.spec.ts (11.235 s)
 FAIL  src/infrastructure/database/repositories/initiatives.repository.spec.ts (11.518 s)
  Ã”Ã¹Ã… InitiativesRepository Ã”Ã‡â•‘ findById Ã”Ã‡â•‘ should return one initiative

    TypeError: this.initiativeRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Initiative | null> {
    > 21 |     return this.initiativeRepository.findOne({
         |                                      ^
      22 |       where: { initiativeId: id },
      23 |       relations: ['status', 'portfolio'],
      24 |     });

      at InitiativesRepository.findById (infrastructure/database/repositories/initiatives.repository.ts:21:38)
      at Object.<anonymous> (infrastructure/database/repositories/initiatives.repository.spec.ts:50:31)

  Ã”Ã¹Ã… InitiativesRepository Ã”Ã‡â•‘ update Ã”Ã‡â•‘ should update an initiative

    TypeError: this.initiativeRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Initiative | null> {
    > 21 |     return this.initiativeRepository.findOne({
         |                                      ^
      22 |       where: { initiativeId: id },
      23 |       relations: ['status', 'portfolio'],
      24 |     });

      at InitiativesRepository.findById (infrastructure/database/repositories/initiatives.repository.ts:21:38)
      at InitiativesRepository.update (infrastructure/database/repositories/initiatives.repository.ts:33:17)
      at Object.<anonymous> (infrastructure/database/repositories/initiatives.repository.spec.ts:67:14)

 PASS  src/application/initiatives/services/initiatives.service.spec.ts (11.484 s)
 PASS  src/infrastructure/repositories/portfolio.repository.spec.ts (11.505 s)
 PASS  src/application/epics/services/epics.service.spec.ts (11.521 s)
 PASS  src/presentation/users/users.controller.spec.ts (11.711 s)
 PASS  src/presentation/auth/auth.controller.spec.ts (11.766 s)
 PASS  src/presentation/catalogs/catalogs.controller.spec.ts (11.839 s)
 PASS  src/presentation/requirements/requirements.controller.spec.ts (12.412 s)
 PASS  src/presentation/initiatives/initiatives.controller.spec.ts (12.775 s)
 PASS  src/presentation/epics/epics.controller.spec.ts (12.934 s)
 FAIL  src/infrastructure/database/repositories/technical-tasks.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/technical-tasks.repository.spec.ts:2:42 - error TS2307: Cannot find module './technical-tasks.repository' or its corresponding type declarations.

    2 import { TechnicalTasksRepository } from './technical-tasks.repository';
                                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/technical-tasks.repository.spec.ts:4:31 - error TS2307: Cannot find module '@domain/entities/technical-task.entity' or its corresponding type declarations.

    4 import { TechnicalTask } from '@domain/entities/technical-task.entity';
                                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/database/repositories/test-cases.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/test-cases.repository.spec.ts:2:37 - error TS2307: Cannot find module './test-cases.repository' or its corresponding type declarations.

    2 import { TestCasesRepository } from './test-cases.repository';
                                          ~~~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/test-cases.repository.spec.ts:4:26 - error TS2307: Cannot find module '@domain/entities/test-case.entity' or its corresponding type declarations.

    4 import { TestCase } from '@domain/entities/test-case.entity';
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/database/repositories/releases.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/releases.repository.spec.ts:2:36 - error TS2307: Cannot find module './releases.repository' or its corresponding type declarations.

    2 import { ReleasesRepository } from './releases.repository';
                                         ~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/releases.repository.spec.ts:4:25 - error TS2307: Cannot find module '@domain/entities/release.entity' or its corresponding type declarations.

    4 import { Release } from '@domain/entities/release.entity';
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/database/repositories/sprints.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/sprints.repository.spec.ts:2:35 - error TS2307: Cannot find module './sprints.repository' or its corresponding type declarations.

    2 import { SprintsRepository } from './sprints.repository';
                                        ~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/sprints.repository.spec.ts:4:24 - error TS2307: Cannot find module '@domain/entities/sprint.entity' or its corresponding type declarations.

    4 import { Sprint } from '@domain/entities/sprint.entity';
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/database/repositories/defects.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/defects.repository.spec.ts:2:35 - error TS2307: Cannot find module './defects.repository' or its corresponding type declarations.

    2 import { DefectsRepository } from './defects.repository';
                                        ~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/defects.repository.spec.ts:4:24 - error TS2307: Cannot find module '@domain/entities/defect.entity' or its corresponding type declarations.

    4 import { Defect } from '@domain/entities/defect.entity';
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/database/repositories/catalogs.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/catalogs.repository.spec.ts:5:24 - error TS2307: Cannot find module '@domain/entities/status.entity' or its corresponding type declarations.

    5 import { Status } from '@domain/entities/status.entity';
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/catalogs.repository.spec.ts:9:22 - error TS2307: Cannot find module '@domain/entities/type.entity' or its corresponding type declarations.

    9 import { Type } from '@domain/entities/type.entity';
                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/database/repositories/backlog.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/backlog.repository.spec.ts:2:35 - error TS2307: Cannot find module './backlog.repository' or its corresponding type declarations.

    2 import { BacklogRepository } from './backlog.repository';
                                        ~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/backlog.repository.spec.ts:4:25 - error TS2307: Cannot find module '@domain/entities/backlog.entity' or its corresponding type declarations.

    4 import { Backlog } from '@domain/entities/backlog.entity';
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  src/application/requirements/services/requirements.service.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/application/requirements/services/requirements.service.spec.ts:50:44 - error TS2345: Argument of type 'Requirement[]' is not assignable to parameter of type '{ items: Requirement[]; total: number; } | Promise<{ items: Requirement[]; total: number; }>'.

    50       repository.findAll.mockResolvedValue([mockRequirement]);
                                                  ~~~~~~~~~~~~~~~~~

 FAIL  src/domain/entities/agile-entities.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/domain/entities/agile-entities.spec.ts:1:22 - error TS2307: Cannot find module './team.entity' or its corresponding type declarations.

    1 import { Team } from './team.entity';
                           ~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:2:28 - error TS2307: Cannot find module './team-member.entity' or its corresponding type declarations.

    2 import { TeamMember } from './team-member.entity';
                                 ~~~~~~~~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:3:39 - error TS2307: Cannot find module './requirement-dependency.entity' or its corresponding type declarations.

    3 import { RequirementDependency } from './requirement-dependency.entity';
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:4:31 - error TS2307: Cannot find module './status-history.entity' or its corresponding type declarations.

    4 import { StatusHistory } from './status-history.entity';
                                    ~~~~~~~~~~~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:5:24 - error TS2307: Cannot find module './sprint.entity' or its corresponding type declarations.

    5 import { Sprint } from './sprint.entity';
                             ~~~~~~~~~~~~~~~~~

 FAIL  src/infrastructure/repositories/requirement.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/repositories/requirement.repository.spec.ts:77:39 - error TS2554: Expected 1 arguments, but got 0.

    77       const result = await repository.findAll();
                                             ~~~~~~~

      src/infrastructure/repositories/requirement.repository.ts:14:17
        14   async findAll(options: any): Promise<{ items: Requirement[], total: number }> {
                           ~~~~~~~~~~~~
        An argument for 'options' was not provided.

 FAIL  src/presentation/portfolios/portfolios.controller.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/presentation/portfolios/portfolios.controller.spec.ts:38:41 - error TS2345: Argument of type 'Portfolio[]' is not assignable to parameter of type '{ items: Portfolio[]; total: number; } | Promise<{ items: Portfolio[]; total: number; }>'.

    38       service.findAll.mockResolvedValue([mockPortfolio]);
                                               ~~~~~~~~~~~~~~~

Summary of all failing tests
 FAIL  infrastructure/auth/guards/jwt-auth.guard.spec.ts (8.87 s)
  Ã”Ã¹Ã… JwtAuthGuard Ã”Ã‡â•‘ canActivate Ã”Ã‡â•‘ should allow access for public routes

    TypeError: context.switchToHttp is not a function

      13 |     // [MOCK-OVERRIDE] Per user request: "no manejar autorizacion por ahora es un mock"
      14 |     // We inject a mock user so controllers don't crash if they access req.user
    > 15 |     const request = context.switchToHttp().getRequest();
         |                             ^
      16 |     request.user = {
      17 |       userId: 'mock-sys-admin',
      18 |       name: 'System Admin (Mock)',

      at JwtAuthGuard.canActivate (infrastructure/auth/guards/jwt-auth.guard.ts:15:29)
      at Object.<anonymous> (infrastructure/auth/guards/jwt-auth.guard.spec.ts:27:28)

  Ã”Ã¹Ã… JwtAuthGuard Ã”Ã‡â•‘ canActivate Ã”Ã‡â•‘ should call parent canActivate for protected routes

    TypeError: context.switchToHttp is not a function

      13 |     // [MOCK-OVERRIDE] Per user request: "no manejar autorizacion por ahora es un mock"
      14 |     // We inject a mock user so controllers don't crash if they access req.user
    > 15 |     const request = context.switchToHttp().getRequest();
         |                             ^
      16 |     request.user = {
      17 |       userId: 'mock-sys-admin',
      18 |       name: 'System Admin (Mock)',

      at JwtAuthGuard.canActivate (infrastructure/auth/guards/jwt-auth.guard.ts:15:29)
      at Object.<anonymous> (infrastructure/auth/guards/jwt-auth.guard.spec.ts:49:13)

 FAIL  infrastructure/database/repositories/epics.repository.spec.ts (9.583 s)
  Ã”Ã¹Ã… EpicsRepository Ã”Ã‡â•‘ findById Ã”Ã‡â•‘ should return one epic

    TypeError: this.epicRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Epic | null> {
    > 21 |     return this.epicRepository.findOne({
         |                                ^
      22 |       where: { epicId: id },
      23 |       relations: ['status', 'initiative', 'requirements'],
      24 |     });

      at EpicsRepository.findById (infrastructure/database/repositories/epics.repository.ts:21:32)
      at Object.<anonymous> (infrastructure/database/repositories/epics.repository.spec.ts:50:31)

  Ã”Ã¹Ã… EpicsRepository Ã”Ã‡â•‘ update Ã”Ã‡â•‘ should update an epic

    TypeError: this.epicRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Epic | null> {
    > 21 |     return this.epicRepository.findOne({
         |                                ^
      22 |       where: { epicId: id },
      23 |       relations: ['status', 'initiative', 'requirements'],
      24 |     });

      at EpicsRepository.findById (infrastructure/database/repositories/epics.repository.ts:21:32)
      at EpicsRepository.update (infrastructure/database/repositories/epics.repository.ts:33:17)
      at Object.<anonymous> (infrastructure/database/repositories/epics.repository.spec.ts:67:14)

 FAIL  infrastructure/database/repositories/initiatives.repository.spec.ts (11.518 s)
  Ã”Ã¹Ã… InitiativesRepository Ã”Ã‡â•‘ findById Ã”Ã‡â•‘ should return one initiative

    TypeError: this.initiativeRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Initiative | null> {
    > 21 |     return this.initiativeRepository.findOne({
         |                                      ^
      22 |       where: { initiativeId: id },
      23 |       relations: ['status', 'portfolio'],
      24 |     });

      at InitiativesRepository.findById (infrastructure/database/repositories/initiatives.repository.ts:21:38)
      at Object.<anonymous> (infrastructure/database/repositories/initiatives.repository.spec.ts:50:31)

  Ã”Ã¹Ã… InitiativesRepository Ã”Ã‡â•‘ update Ã”Ã‡â•‘ should update an initiative

    TypeError: this.initiativeRepository.findOne is not a function

      19 |
      20 |   async findById(id: string): Promise<Initiative | null> {
    > 21 |     return this.initiativeRepository.findOne({
         |                                      ^
      22 |       where: { initiativeId: id },
      23 |       relations: ['status', 'portfolio'],
      24 |     });

      at InitiativesRepository.findById (infrastructure/database/repositories/initiatives.repository.ts:21:38)
      at InitiativesRepository.update (infrastructure/database/repositories/initiatives.repository.ts:33:17)
      at Object.<anonymous> (infrastructure/database/repositories/initiatives.repository.spec.ts:67:14)

 FAIL  infrastructure/database/repositories/technical-tasks.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/technical-tasks.repository.spec.ts:2:42 - error TS2307: Cannot find module './technical-tasks.repository' or its corresponding type declarations.

    2 import { TechnicalTasksRepository } from './technical-tasks.repository';
                                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/technical-tasks.repository.spec.ts:4:31 - error TS2307: Cannot find module '@domain/entities/technical-task.entity' or its corresponding type declarations.

    4 import { TechnicalTask } from '@domain/entities/technical-task.entity';
                                    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/database/repositories/test-cases.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/test-cases.repository.spec.ts:2:37 - error TS2307: Cannot find module './test-cases.repository' or its corresponding type declarations.

    2 import { TestCasesRepository } from './test-cases.repository';
                                          ~~~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/test-cases.repository.spec.ts:4:26 - error TS2307: Cannot find module '@domain/entities/test-case.entity' or its corresponding type declarations.

    4 import { TestCase } from '@domain/entities/test-case.entity';
                               ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/database/repositories/releases.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/releases.repository.spec.ts:2:36 - error TS2307: Cannot find module './releases.repository' or its corresponding type declarations.

    2 import { ReleasesRepository } from './releases.repository';
                                         ~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/releases.repository.spec.ts:4:25 - error TS2307: Cannot find module '@domain/entities/release.entity' or its corresponding type declarations.

    4 import { Release } from '@domain/entities/release.entity';
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/database/repositories/sprints.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/sprints.repository.spec.ts:2:35 - error TS2307: Cannot find module './sprints.repository' or its corresponding type declarations.

    2 import { SprintsRepository } from './sprints.repository';
                                        ~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/sprints.repository.spec.ts:4:24 - error TS2307: Cannot find module '@domain/entities/sprint.entity' or its corresponding type declarations.

    4 import { Sprint } from '@domain/entities/sprint.entity';
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/database/repositories/defects.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/defects.repository.spec.ts:2:35 - error TS2307: Cannot find module './defects.repository' or its corresponding type declarations.

    2 import { DefectsRepository } from './defects.repository';
                                        ~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/defects.repository.spec.ts:4:24 - error TS2307: Cannot find module '@domain/entities/defect.entity' or its corresponding type declarations.

    4 import { Defect } from '@domain/entities/defect.entity';
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/database/repositories/catalogs.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/catalogs.repository.spec.ts:5:24 - error TS2307: Cannot find module '@domain/entities/status.entity' or its corresponding type declarations.

    5 import { Status } from '@domain/entities/status.entity';
                             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/catalogs.repository.spec.ts:9:22 - error TS2307: Cannot find module '@domain/entities/type.entity' or its corresponding type declarations.

    9 import { Type } from '@domain/entities/type.entity';
                           ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/database/repositories/backlog.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/database/repositories/backlog.repository.spec.ts:2:35 - error TS2307: Cannot find module './backlog.repository' or its corresponding type declarations.

    2 import { BacklogRepository } from './backlog.repository';
                                        ~~~~~~~~~~~~~~~~~~~~~~
    src/infrastructure/database/repositories/backlog.repository.spec.ts:4:25 - error TS2307: Cannot find module '@domain/entities/backlog.entity' or its corresponding type declarations.

    4 import { Backlog } from '@domain/entities/backlog.entity';
                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 FAIL  application/requirements/services/requirements.service.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/application/requirements/services/requirements.service.spec.ts:50:44 - error TS2345: Argument of type 'Requirement[]' is not assignable to parameter of type '{ items: Requirement[]; total: number; } | Promise<{ items: Requirement[]; total: number; }>'.

    50       repository.findAll.mockResolvedValue([mockRequirement]);
                                                  ~~~~~~~~~~~~~~~~~

 FAIL  domain/entities/agile-entities.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/domain/entities/agile-entities.spec.ts:1:22 - error TS2307: Cannot find module './team.entity' or its corresponding type declarations.

    1 import { Team } from './team.entity';
                           ~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:2:28 - error TS2307: Cannot find module './team-member.entity' or its corresponding type declarations.

    2 import { TeamMember } from './team-member.entity';
                                 ~~~~~~~~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:3:39 - error TS2307: Cannot find module './requirement-dependency.entity' or its corresponding type declarations.

    3 import { RequirementDependency } from './requirement-dependency.entity';
                                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:4:31 - error TS2307: Cannot find module './status-history.entity' or its corresponding type declarations.

    4 import { StatusHistory } from './status-history.entity';
                                    ~~~~~~~~~~~~~~~~~~~~~~~~~
    src/domain/entities/agile-entities.spec.ts:5:24 - error TS2307: Cannot find module './sprint.entity' or its corresponding type declarations.

    5 import { Sprint } from './sprint.entity';
                             ~~~~~~~~~~~~~~~~~

 FAIL  infrastructure/repositories/requirement.repository.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/infrastructure/repositories/requirement.repository.spec.ts:77:39 - error TS2554: Expected 1 arguments, but got 0.

    77       const result = await repository.findAll();
                                             ~~~~~~~

      src/infrastructure/repositories/requirement.repository.ts:14:17
        14   async findAll(options: any): Promise<{ items: Requirement[], total: number }> {
                           ~~~~~~~~~~~~
        An argument for 'options' was not provided.

 FAIL  presentation/portfolios/portfolios.controller.spec.ts
  Ã”Ã¹Ã… Test suite failed to run

    src/presentation/portfolios/portfolios.controller.spec.ts:38:41 - error TS2345: Argument of type 'Portfolio[]' is not assignable to parameter of type '{ items: Portfolio[]; total: number; } | Promise<{ items: Portfolio[]; total: number; }>'.

    38       service.findAll.mockResolvedValue([mockPortfolio]);
                                               ~~~~~~~~~~~~~~~


Test Suites: 14 failed, 28 passed, 42 total
Tests:       6 failed, 157 passed, 163 total
Snapshots:   0 total
Time:        16.776 s
Ran all test suites.



 NX   Running target test for project api failed

Failed tasks:

- api:test

Hint: run the command with --verbose for more details.

Warning: command "jest --config jest.config.js" exited with non-zero status code
